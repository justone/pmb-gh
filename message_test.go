package main

import "testing"

func assert(t *testing.T, cond bool, msg string) {
	if !cond {
		t.Errorf(msg)
	}
}

func TestBadJSON(t *testing.T) {
	_, err := parseEvent("watch", `{"action":"started"`)

	if err == nil {
		t.Errorf("error should be thrown")
	}
}

func TestWatch(t *testing.T) {
	name := "watch"
	json := `{"action":"started","repository":{"id":48729606,"name":"repositoryname","full_name":"owninguser/repositoryname","owner":{"login":"owninguser","id":8082,"avatar_url":"https://avatars.githubusercontent.com/u/8082?v=3","gravatar_id":"","url":"https://api.github.com/users/owninguser","html_url":"https://github.com/owninguser","followers_url":"https://api.github.com/users/owninguser/followers","following_url":"https://api.github.com/users/owninguser/following{/other_user}","gists_url":"https://api.github.com/users/owninguser/gists{/gist_id}","starred_url":"https://api.github.com/users/owninguser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/owninguser/subscriptions","organizations_url":"https://api.github.com/users/owninguser/orgs","repos_url":"https://api.github.com/users/owninguser/repos","events_url":"https://api.github.com/users/owninguser/events{/privacy}","received_events_url":"https://api.github.com/users/owninguser/received_events","type":"User","site_admin":false},"private":false,"html_url":"https://github.com/owninguser/repositoryname","description":"","fork":false,"url":"https://api.github.com/repos/owninguser/repositoryname","forks_url":"https://api.github.com/repos/owninguser/repositoryname/forks","keys_url":"https://api.github.com/repos/owninguser/repositoryname/keys{/key_id}","collaborators_url":"https://api.github.com/repos/owninguser/repositoryname/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/owninguser/repositoryname/teams","hooks_url":"https://api.github.com/repos/owninguser/repositoryname/hooks","issue_events_url":"https://api.github.com/repos/owninguser/repositoryname/issues/events{/number}","events_url":"https://api.github.com/repos/owninguser/repositoryname/events","assignees_url":"https://api.github.com/repos/owninguser/repositoryname/assignees{/user}","branches_url":"https://api.github.com/repos/owninguser/repositoryname/branches{/branch}","tags_url":"https://api.github.com/repos/owninguser/repositoryname/tags","blobs_url":"https://api.github.com/repos/owninguser/repositoryname/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/owninguser/repositoryname/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/owninguser/repositoryname/git/refs{/sha}","trees_url":"https://api.github.com/repos/owninguser/repositoryname/git/trees{/sha}","statuses_url":"https://api.github.com/repos/owninguser/repositoryname/statuses/{sha}","languages_url":"https://api.github.com/repos/owninguser/repositoryname/languages","stargazers_url":"https://api.github.com/repos/owninguser/repositoryname/stargazers","contributors_url":"https://api.github.com/repos/owninguser/repositoryname/contributors","subscribers_url":"https://api.github.com/repos/owninguser/repositoryname/subscribers","subscription_url":"https://api.github.com/repos/owninguser/repositoryname/subscription","commits_url":"https://api.github.com/repos/owninguser/repositoryname/commits{/sha}","git_commits_url":"https://api.github.com/repos/owninguser/repositoryname/git/commits{/sha}","comments_url":"https://api.github.com/repos/owninguser/repositoryname/comments{/number}","issue_comment_url":"https://api.github.com/repos/owninguser/repositoryname/issues/comments{/number}","contents_url":"https://api.github.com/repos/owninguser/repositoryname/contents/{+path}","compare_url":"https://api.github.com/repos/owninguser/repositoryname/compare/{base}...{head}","merges_url":"https://api.github.com/repos/owninguser/repositoryname/merges","archive_url":"https://api.github.com/repos/owninguser/repositoryname/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/owninguser/repositoryname/downloads","issues_url":"https://api.github.com/repos/owninguser/repositoryname/issues{/number}","pulls_url":"https://api.github.com/repos/owninguser/repositoryname/pulls{/number}","milestones_url":"https://api.github.com/repos/owninguser/repositoryname/milestones{/number}","notifications_url":"https://api.github.com/repos/owninguser/repositoryname/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/owninguser/repositoryname/labels{/name}","releases_url":"https://api.github.com/repos/owninguser/repositoryname/releases{/id}","created_at":"2015-12-29T05:37:45Z","updated_at":"2015-12-29T05:57:40Z","pushed_at":"2015-12-29T05:37:45Z","git_url":"git://github.com/owninguser/repositoryname.git","ssh_url":"git@github.com:owninguser/repositoryname.git","clone_url":"https://github.com/owninguser/repositoryname.git","svn_url":"https://github.com/owninguser/repositoryname","homepage":null,"size":0,"stargazers_count":0,"watchers_count":0,"language":null,"has_issues":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":0,"default_branch":"master"},"sender":{"login":"otheruser","id":1062602,"avatar_url":"https://avatars.githubusercontent.com/u/1062602?v=3","gravatar_id":"","url":"https://api.github.com/users/otheruser","html_url":"https://github.com/otheruser","followers_url":"https://api.github.com/users/otheruser/followers","following_url":"https://api.github.com/users/otheruser/following{/other_user}","gists_url":"https://api.github.com/users/otheruser/gists{/gist_id}","starred_url":"https://api.github.com/users/otheruser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/otheruser/subscriptions","organizations_url":"https://api.github.com/users/otheruser/orgs","repos_url":"https://api.github.com/users/otheruser/repos","events_url":"https://api.github.com/users/otheruser/events{/privacy}","received_events_url":"https://api.github.com/users/otheruser/received_events","type":"User","site_admin":false}}`
	note, err := parseEvent(name, json)

	if err != nil {
		t.Errorf("Error: %s", err)
	}

	assert(t, note.Message == "New star for owninguser/repositoryname by otheruser.", "Message incorrect")
	assert(t, note.URL == "https://github.com/otheruser", "URL incorrect")
}

func TestFork(t *testing.T) {
	name := "fork"
	json := `{"forkee":{"id":48730440,"name":"repositoryname","full_name":"otheruser/repositoryname","owner":{"login":"otheruser","id":1062602,"avatar_url":"https://avatars.githubusercontent.com/u/1062602?v=3","gravatar_id":"","url":"https://api.github.com/users/otheruser","html_url":"https://github.com/otheruser","followers_url":"https://api.github.com/users/otheruser/followers","following_url":"https://api.github.com/users/otheruser/following{/other_user}","gists_url":"https://api.github.com/users/otheruser/gists{/gist_id}","starred_url":"https://api.github.com/users/otheruser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/otheruser/subscriptions","organizations_url":"https://api.github.com/users/otheruser/orgs","repos_url":"https://api.github.com/users/otheruser/repos","events_url":"https://api.github.com/users/otheruser/events{/privacy}","received_events_url":"https://api.github.com/users/otheruser/received_events","type":"User","site_admin":false},"private":false,"html_url":"https://github.com/otheruser/repositoryname","description":"","fork":true,"url":"https://api.github.com/repos/otheruser/repositoryname","forks_url":"https://api.github.com/repos/otheruser/repositoryname/forks","keys_url":"https://api.github.com/repos/otheruser/repositoryname/keys{/key_id}","collaborators_url":"https://api.github.com/repos/otheruser/repositoryname/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/otheruser/repositoryname/teams","hooks_url":"https://api.github.com/repos/otheruser/repositoryname/hooks","issue_events_url":"https://api.github.com/repos/otheruser/repositoryname/issues/events{/number}","events_url":"https://api.github.com/repos/otheruser/repositoryname/events","assignees_url":"https://api.github.com/repos/otheruser/repositoryname/assignees{/user}","branches_url":"https://api.github.com/repos/otheruser/repositoryname/branches{/branch}","tags_url":"https://api.github.com/repos/otheruser/repositoryname/tags","blobs_url":"https://api.github.com/repos/otheruser/repositoryname/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/otheruser/repositoryname/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/otheruser/repositoryname/git/refs{/sha}","trees_url":"https://api.github.com/repos/otheruser/repositoryname/git/trees{/sha}","statuses_url":"https://api.github.com/repos/otheruser/repositoryname/statuses/{sha}","languages_url":"https://api.github.com/repos/otheruser/repositoryname/languages","stargazers_url":"https://api.github.com/repos/otheruser/repositoryname/stargazers","contributors_url":"https://api.github.com/repos/otheruser/repositoryname/contributors","subscribers_url":"https://api.github.com/repos/otheruser/repositoryname/subscribers","subscription_url":"https://api.github.com/repos/otheruser/repositoryname/subscription","commits_url":"https://api.github.com/repos/otheruser/repositoryname/commits{/sha}","git_commits_url":"https://api.github.com/repos/otheruser/repositoryname/git/commits{/sha}","comments_url":"https://api.github.com/repos/otheruser/repositoryname/comments{/number}","issue_comment_url":"https://api.github.com/repos/otheruser/repositoryname/issues/comments{/number}","contents_url":"https://api.github.com/repos/otheruser/repositoryname/contents/{+path}","compare_url":"https://api.github.com/repos/otheruser/repositoryname/compare/{base}...{head}","merges_url":"https://api.github.com/repos/otheruser/repositoryname/merges","archive_url":"https://api.github.com/repos/otheruser/repositoryname/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/otheruser/repositoryname/downloads","issues_url":"https://api.github.com/repos/otheruser/repositoryname/issues{/number}","pulls_url":"https://api.github.com/repos/otheruser/repositoryname/pulls{/number}","milestones_url":"https://api.github.com/repos/otheruser/repositoryname/milestones{/number}","notifications_url":"https://api.github.com/repos/otheruser/repositoryname/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/otheruser/repositoryname/labels{/name}","releases_url":"https://api.github.com/repos/otheruser/repositoryname/releases{/id}","created_at":"2015-12-29T06:00:21Z","updated_at":"2015-12-29T06:00:09Z","pushed_at":"2015-12-29T05:37:45Z","git_url":"git://github.com/otheruser/repositoryname.git","ssh_url":"git@github.com:otheruser/repositoryname.git","clone_url":"https://github.com/otheruser/repositoryname.git","svn_url":"https://github.com/otheruser/repositoryname","homepage":null,"size":0,"stargazers_count":0,"watchers_count":0,"language":null,"has_issues":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":0,"default_branch":"master","public":true},"repository":{"id":48729606,"name":"repositoryname","full_name":"owninguser/repositoryname","owner":{"login":"owninguser","id":8082,"avatar_url":"https://avatars.githubusercontent.com/u/8082?v=3","gravatar_id":"","url":"https://api.github.com/users/owninguser","html_url":"https://github.com/owninguser","followers_url":"https://api.github.com/users/owninguser/followers","following_url":"https://api.github.com/users/owninguser/following{/other_user}","gists_url":"https://api.github.com/users/owninguser/gists{/gist_id}","starred_url":"https://api.github.com/users/owninguser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/owninguser/subscriptions","organizations_url":"https://api.github.com/users/owninguser/orgs","repos_url":"https://api.github.com/users/owninguser/repos","events_url":"https://api.github.com/users/owninguser/events{/privacy}","received_events_url":"https://api.github.com/users/owninguser/received_events","type":"User","site_admin":false},"private":false,"html_url":"https://github.com/owninguser/repositoryname","description":"","fork":false,"url":"https://api.github.com/repos/owninguser/repositoryname","forks_url":"https://api.github.com/repos/owninguser/repositoryname/forks","keys_url":"https://api.github.com/repos/owninguser/repositoryname/keys{/key_id}","collaborators_url":"https://api.github.com/repos/owninguser/repositoryname/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/owninguser/repositoryname/teams","hooks_url":"https://api.github.com/repos/owninguser/repositoryname/hooks","issue_events_url":"https://api.github.com/repos/owninguser/repositoryname/issues/events{/number}","events_url":"https://api.github.com/repos/owninguser/repositoryname/events","assignees_url":"https://api.github.com/repos/owninguser/repositoryname/assignees{/user}","branches_url":"https://api.github.com/repos/owninguser/repositoryname/branches{/branch}","tags_url":"https://api.github.com/repos/owninguser/repositoryname/tags","blobs_url":"https://api.github.com/repos/owninguser/repositoryname/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/owninguser/repositoryname/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/owninguser/repositoryname/git/refs{/sha}","trees_url":"https://api.github.com/repos/owninguser/repositoryname/git/trees{/sha}","statuses_url":"https://api.github.com/repos/owninguser/repositoryname/statuses/{sha}","languages_url":"https://api.github.com/repos/owninguser/repositoryname/languages","stargazers_url":"https://api.github.com/repos/owninguser/repositoryname/stargazers","contributors_url":"https://api.github.com/repos/owninguser/repositoryname/contributors","subscribers_url":"https://api.github.com/repos/owninguser/repositoryname/subscribers","subscription_url":"https://api.github.com/repos/owninguser/repositoryname/subscription","commits_url":"https://api.github.com/repos/owninguser/repositoryname/commits{/sha}","git_commits_url":"https://api.github.com/repos/owninguser/repositoryname/git/commits{/sha}","comments_url":"https://api.github.com/repos/owninguser/repositoryname/comments{/number}","issue_comment_url":"https://api.github.com/repos/owninguser/repositoryname/issues/comments{/number}","contents_url":"https://api.github.com/repos/owninguser/repositoryname/contents/{+path}","compare_url":"https://api.github.com/repos/owninguser/repositoryname/compare/{base}...{head}","merges_url":"https://api.github.com/repos/owninguser/repositoryname/merges","archive_url":"https://api.github.com/repos/owninguser/repositoryname/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/owninguser/repositoryname/downloads","issues_url":"https://api.github.com/repos/owninguser/repositoryname/issues{/number}","pulls_url":"https://api.github.com/repos/owninguser/repositoryname/pulls{/number}","milestones_url":"https://api.github.com/repos/owninguser/repositoryname/milestones{/number}","notifications_url":"https://api.github.com/repos/owninguser/repositoryname/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/owninguser/repositoryname/labels{/name}","releases_url":"https://api.github.com/repos/owninguser/repositoryname/releases{/id}","created_at":"2015-12-29T05:37:45Z","updated_at":"2015-12-29T06:00:09Z","pushed_at":"2015-12-29T05:37:45Z","git_url":"git://github.com/owninguser/repositoryname.git","ssh_url":"git@github.com:owninguser/repositoryname.git","clone_url":"https://github.com/owninguser/repositoryname.git","svn_url":"https://github.com/owninguser/repositoryname","homepage":null,"size":0,"stargazers_count":0,"watchers_count":0,"language":null,"has_issues":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":1,"mirror_url":null,"open_issues_count":0,"forks":1,"open_issues":0,"watchers":0,"default_branch":"master"},"sender":{"login":"otheruser","id":1062602,"avatar_url":"https://avatars.githubusercontent.com/u/1062602?v=3","gravatar_id":"","url":"https://api.github.com/users/otheruser","html_url":"https://github.com/otheruser","followers_url":"https://api.github.com/users/otheruser/followers","following_url":"https://api.github.com/users/otheruser/following{/other_user}","gists_url":"https://api.github.com/users/otheruser/gists{/gist_id}","starred_url":"https://api.github.com/users/otheruser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/otheruser/subscriptions","organizations_url":"https://api.github.com/users/otheruser/orgs","repos_url":"https://api.github.com/users/otheruser/repos","events_url":"https://api.github.com/users/otheruser/events{/privacy}","received_events_url":"https://api.github.com/users/otheruser/received_events","type":"User","site_admin":false}}`
	note, err := parseEvent(name, json)

	if err != nil {
		t.Errorf("Error: %s", err)
	}

	assert(t, note.Message == "New fork for owninguser/repositoryname by otheruser.", "Message incorrect")
	assert(t, note.URL == "https://github.com/otheruser/repositoryname", "URL incorrect")
}
